<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Mode Timer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        #timer-display {
            font-size: clamp(3rem, 18vw, 5.5rem);
            line-height: 1;
        }
        .timer-ring-container {
            transition: transform 0.5s ease;
        }
        .time-warning .timer-ring-container { animation: pulse 1s infinite; }
        .time-critical .timer-ring-container { animation: shake 0.5s infinite; }

        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }
        @keyframes shake { 0%, 100% { transform: translate(0, 0) rotate(0); } 25% { transform: translate(2px, -2px) rotate(1deg); } 50% { transform: translate(-2px, 2px) rotate(-1deg); } 75% { transform: translate(2px, 2px) rotate(1deg); } }
        
        .leaderboard-item { transition: all 0.3s ease; }
        .leaderboard-item-clickable { cursor: pointer; }
        .current-leader { transform: scale(1.05); }
        .selected-leaderboard-item { background-color: #eef2ff; border-color: #818cf8 !important; transform: scale(1.05); }
        .eliminated { opacity: 0.5; text-decoration: line-through; background-color: #e2e8f0; }
        #notification { transition: opacity 0.5s, transform 0.5s; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        input[type="color"] { -webkit-appearance: none; border: none; width: 32px; height: 32px; cursor: pointer; border-radius: 50%; overflow: hidden; }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: none; border-radius: 50%; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 flex flex-col items-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-4xl mx-auto">
        
        <!-- 설정 섹션 -->
        <div id="settings-view" class="bg-white p-6 rounded-2xl shadow-lg mb-6">
            <h1 class="text-3xl font-bold text-center text-blue-600 mb-6" data-i18n="settingsTitle">게임 타이머 설정</h1>
            
            <div class="mb-6">
                <label for="game-name-input" class="text-xl font-semibold mb-3 text-slate-700 block" data-i18n="gameNameLabel">게임 이름</label>
                <input type="text" id="game-name-input" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" data-i18n-placeholder="gameNameHint">
            </div>

            <div class="grid md:grid-cols-2 gap-x-8 gap-y-6 border-t pt-6">
                <!-- 플레이어 추가 -->
                <div>
                    <h2 class="text-xl font-semibold mb-3 text-slate-700" data-i18n="addPlayerTitle">1. 플레이어 추가</h2>
                    <div class="flex items-center gap-2">
                        <input type="color" id="new-user-color" value="#3b82f6" title="색상 선택">
                        <input type="text" id="new-user-name" class="flex-grow w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" data-i18n-placeholder="playerNameHint">
                        <button id="add-user-btn" class="bg-blue-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-600 shadow" data-i18n="addButton">추가</button>
                    </div>
                    <div id="user-list" class="mt-4 space-y-2 max-h-40 overflow-y-auto pr-2"></div>
                </div>

                <!-- 시간 설정 -->
                <div>
                    <h2 class="text-xl font-semibold mb-3 text-slate-700" data-i18n="timeSettingsTitle">2. 시간 설정</h2>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between items-center">
                                <label for="turn-time" class="block text-sm font-medium text-slate-600" data-i18n="baseTimeLabel">기본 시간</label>
                                <button id="turn-time-unit-btn" data-unit="sec" class="text-sm bg-slate-200 text-slate-600 font-semibold px-3 py-1 rounded-full" data-i18n="unitSec">초</button>
                            </div>
                            <input type="number" id="turn-time" value="30" min="1" class="w-full mt-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <div class="flex justify-between items-center">
                                <label for="extra-time" class="block text-sm font-medium text-slate-600" data-i18n="extraTimeLabel">추가 시간</label>
                                <button id="extra-time-unit-btn" data-unit="sec" class="text-sm bg-slate-200 text-slate-600 font-semibold px-3 py-1 rounded-full" data-i18n="unitSec">초</button>
                            </div>
                            <input type="number" id="extra-time" value="60" min="0" class="w-full mt-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>

                <!-- 게임 모드 설정 -->
                <div class="md:col-span-2 border-t pt-6">
                    <h2 class="text-xl font-semibold mb-4 text-slate-700" data-i18n="gameModeTitle">3. 게임 모드 설정</h2>
                    <div class="space-y-4">
                        <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg">
                            <input type="checkbox" id="sudden-death-mode" class="h-5 w-5 rounded text-blue-600 focus:ring-blue-500">
                            <span class="font-medium" data-i18n="suddenDeathLabel">서든데스 모드 활성화</span>
                        </label>
                        <div class="p-3 bg-slate-50 rounded-lg">
                            <label class="flex items-center gap-3">
                                <input type="checkbox" id="quick-turn-bonus-mode" checked class="h-5 w-5 rounded text-blue-600 focus:ring-blue-500">
                                <span class="font-medium" data-i18n="quickTurnBonusLabel">퀵 턴 보너스</span>
                            </label>
                            <div class="text-sm text-slate-500 mt-2 pl-8" data-i18n="quickTurnBonusDesc">
                                턴 시작 후 <input type="number" id="bonus-condition-time" value="5" class="w-16 text-center mx-1 border-b">초 안에 넘기면 추가 시간 <input type="number" id="bonus-reward-time" value="3" class="w-16 text-center mx-1 border-b">초 획득!
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 text-center">
                <button id="start-timer-btn" class="bg-green-500 text-white px-10 py-3 rounded-lg font-bold text-lg hover:bg-green-600 shadow-lg disabled:bg-slate-400 disabled:cursor-not-allowed" data-i18n="startGameButton">게임 시작</button>
            </div>
        </div>

        <!-- 타이머 뷰 -->
        <div id="timer-view" class="hidden relative">
            <!-- 음소거 버튼 -->
            <button id="mute-btn" class="absolute top-4 right-4 z-10 p-2 bg-white rounded-full shadow-md">
                <svg id="volume-icon" class="w-6 h-6 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>
                <svg id="mute-icon" class="w-6 h-6 text-slate-600 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15zM17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"></path></svg>
            </button>
            <!-- 보너스 알림 -->
            <div id="notification" class="absolute top-1/3 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-yellow-300 text-yellow-800 font-bold px-6 py-3 rounded-full shadow-lg opacity-0 transform scale-50 z-20"></div>

            <div class="grid lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-lg flex flex-col items-center justify-center text-center">
                    <h2 id="current-user-name" class="text-4xl font-bold mb-2">플레이어 이름</h2>
                    <p class="text-slate-500 mb-6" data-i18n="turnSuffix">'s turn</p>
                    
                    <div class="relative w-64 h-64 sm:w-80 sm:h-80 mb-6 timer-ring-container">
                        <svg class="w-full h-full" viewBox="0 0 100 100">
                            <circle class="text-slate-200" stroke-width="8" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50" />
                            <circle id="timer-progress-ring" stroke-width="8" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50" stroke-linecap="round" transform="rotate(-90 50 50)" style="stroke-dasharray: 282.7; stroke-dashoffset: 282.7;" />
                        </svg>
                        <div id="timer-display-container" class="absolute inset-0 flex flex-col items-center justify-center">
                            <span id="timer-display" class="font-bold">00:00</span>
                            <span id="extra-time-indicator" class="text-amber-500 font-bold text-lg hidden" data-i18n="extraTimeIndicator">추가 시간 사용 중</span>
                        </div>
                    </div>
                    
                    <div id="user-extra-time-display" class="mb-6 text-lg"><span data-i18n="extraTimeRemaining">남은 추가 시간:</span> <span id="current-user-extra-time" class="font-bold">0</span><span data-i18n="unitSec">초</span></div>

                    <div class="w-full px-4 sm:px-0 sm:max-w-xs sm:mx-auto">
                        <button id="next-turn-btn" class="w-full bg-amber-500 text-white px-6 py-4 rounded-lg font-bold text-lg hover:bg-amber-600 shadow-md" data-i18n="nextTurnButton">차례 넘기기</button>
                        <button id="start-turn-btn" class="w-full bg-blue-500 text-white px-6 py-4 rounded-lg font-bold text-lg hover:bg-blue-600 shadow-md hidden" data-i18n="startButton">시작</button>
                    </div>
                </div>

                <div class="space-y-6">
                    <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <h3 class="text-2xl font-bold mb-2 text-center" data-i18n="leaderboardTitle">리더보드</h3>
                        <p class="text-center text-sm text-slate-500 mb-4" data-i18n="leaderboardDesc">순서 변경(▲/▼) / 기록 보기(클릭)</p>
                        <div id="leaderboard" class="space-y-3 max-h-80 overflow-y-auto pr-2"></div>
                    </div>

                    <!-- 상세 랩타임 뷰 -->
                    <div id="lap-details-view" class="hidden bg-white p-6 rounded-2xl shadow-lg">
                        <h3 id="lap-details-title" class="text-xl font-bold mb-4 text-center"></h3>
                        <div id="lap-details-list" class="space-y-2 max-h-48 overflow-y-auto pr-2 text-center"></div>
                    </div>

                    <div class="bg-white p-6 rounded-2xl shadow-lg text-center">
                        <h3 class="text-2xl font-bold mb-4 text-center" data-i18n="controlPanelTitle">제어판</h3>
                        <button id="end-game-btn" class="w-full bg-red-500 text-white px-6 py-3 rounded-lg font-bold hover:bg-red-600 shadow" data-i18n="endGameButton">게임 종료</button>
                    </div>
                </div>
            </div>
             <div id="total-time-container" class="mt-6 text-center text-xl font-semibold text-slate-600">
                <span data-i18n="totalTimeLabel">총 진행 시간:</span> <span id="total-game-time">00:00</span>
            </div>
        </div>
        
        <!-- 게임 종료 모달 -->
        <div id="game-over-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white text-center p-10 rounded-2xl shadow-2xl transform transition-all scale-95">
                <h2 class="text-5xl font-bold text-yellow-500 mb-4" data-i18n="victoryTitle">🏆 승리 🏆</h2>
                <p id="winner-name" class="text-3xl font-semibold text-slate-800 mb-8"></p>
                <button id="view-summary-btn" class="bg-blue-500 text-white px-8 py-3 rounded-lg font-bold text-lg hover:bg-blue-600" data-i18n="viewResultsButton">결과 보기</button>
            </div>
        </div>

        <!-- 닉네임 추천 모달 -->
        <div id="nickname-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
            <div class="bg-white w-full max-w-md p-6 rounded-2xl shadow-xl">
                <h2 class="text-2xl font-bold text-center mb-4" data-i18n="playerSettingsTitle">플레이어 설정</h2>
                <p class="text-center text-slate-500 mb-6" data-i18n="playerSettingsDesc">닉네임과 색상을 설정해주세요.</p>
                
                <div class="flex items-center justify-center gap-4 mb-6">
                    <label for="modal-user-color" class="font-medium text-slate-600" data-i18n="colorLabel">색상:</label>
                    <input type="color" id="modal-user-color" value="#3b82f6" title="색상 선택">
                </div>

                <div class="flex items-center gap-2 mb-4">
                    <input type="text" id="modal-nickname-input" class="flex-grow w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" data-i18n-placeholder="nicknameInputHint">
                </div>
                <div id="nickname-suggestions" class="grid grid-cols-3 gap-2 mb-6">
                </div>
                 <p id="modal-error-msg" class="text-red-500 text-center text-sm mb-4 h-5"></p>
                <div class="flex gap-4">
                    <button id="modal-cancel-btn" class="w-full bg-slate-200 text-slate-700 px-6 py-2 rounded-lg font-semibold hover:bg-slate-300" data-i18n="cancelButton">취소</button>
                    <button id="modal-confirm-btn" class="w-full bg-blue-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-600" data-i18n="confirmButton">확인</button>
                </div>
            </div>
        </div>
        
        <!-- 점수 입력 모달 -->
        <div id="score-input-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
            <div class="bg-white w-full max-w-md p-6 rounded-2xl shadow-xl">
                <h2 class="text-2xl font-bold text-center mb-4" data-i18n="scoreInputTitle">점수 입력</h2>
                <p class="text-center text-slate-500 mb-6" data-i18n="scoreInputDesc">각 플레이어의 최종 점수를 입력하세요.</p>
                <div id="score-input-list" class="space-y-4 max-h-80 overflow-y-auto pr-2 mb-6">
                    <!-- 점수 입력 필드가 여기에 삽입됩니다 -->
                </div>
                <button id="show-summary-from-scores-btn" class="w-full bg-blue-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-600" data-i18n="viewResultsButton">결과 보기</button>
            </div>
        </div>

        <!-- 최종 결과 모달 -->
        <div id="summary-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
            <div class="w-full max-w-lg">
                <div id="summary-content" class="bg-white p-8 rounded-2xl shadow-2xl">
                    <h2 id="summary-game-name" class="text-4xl font-bold text-center mb-2">게임 결과</h2>
                    <p class="text-center text-slate-500 mb-6"><span data-i18n="totalTimeLabel">총 진행 시간:</span> <span id="summary-total-time" class="font-semibold"></span></p>
                    <div id="summary-player-list" class="space-y-3 max-h-80 overflow-y-auto pr-2 border-t pt-4">
                        <!-- 플레이어 결과 목록 -->
                    </div>
                </div>
                <div class="mt-6 flex gap-4">
                    <button id="reset-game-btn" class="w-full bg-blue-500 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-600" data-i18n="newGameButton">새 게임 시작</button>
                    <button id="save-image-btn" class="w-full bg-green-500 text-white px-6 py-3 rounded-lg font-bold hover:bg-green-600" data-i18n="saveAsImageButton">이미지로 저장</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 다국어 처리 ---
            const translations = {
                en: {
                    settingsTitle: "Game Timer Settings", gameNameLabel: "Game Name", gameNameHint: "What is today's game?", addPlayerTitle: "1. Add Players", playerNameHint: "Player Name (1-100)", addButton: "Add", timeSettingsTitle: "2. Time Settings", baseTimeLabel: "Base Time", extraTimeLabel: "Extra Time", unitSec: "sec", unitMin: "min", gameModeTitle: "3. Game Mode Settings", suddenDeathLabel: "Enable Sudden Death Mode", quickTurnBonusLabel: "Quick Turn Bonus", quickTurnBonusDesc: 'Get +<input type="number" id="bonus-reward-time" value="3" class="w-16 text-center mx-1 border-b">s bonus for passing within <input type="number" id="bonus-condition-time" value="5" class="w-16 text-center mx-1 border-b">s!', startGameButton: "Start Game", turnSuffix: "'s turn", extraTimeIndicator: "Using Extra Time", extraTimeRemaining: "Extra time left:", nextTurnButton: "Next Turn", startButton: "Start", leaderboardTitle: "Leaderboard", leaderboardDesc: "Change order (▲/▼) / View records (Click)", controlPanelTitle: "Control Panel", endGameButton: "End Game", totalTimeLabel: "Total Time:", victoryTitle: "🏆 VICTORY 🏆", viewResultsButton: "View Results", playerSettingsTitle: "Player Settings", playerSettingsDesc: "Set nickname and color.", colorLabel: "Color:", nicknameInputHint: "Enter desired nickname", cancelButton: "Cancel", confirmButton: "Confirm", scoreInputTitle: "Enter Scores", scoreInputDesc: "Enter the final score for each player.", newGameButton: "New Game", saveAsImageButton: "Save as Image", alertNameExists: "This name is already taken.", alertColorExists: "This color is already taken.", alertMaxPlayers: "A maximum of 100 players can be added.", alertNicknameRequired: "Please enter or select a nickname.", notificationBonus: "+{time}s Bonus!", notificationEliminated: "{name} eliminated!", detailsTitle: "{name} - Detailed Records", detailsNoRecords: "No records yet.",
                },
                de: {
                    settingsTitle: "Spiel-Timer-Einstellungen", gameNameLabel: "Spielname", gameNameHint: "Was ist das heutige Spiel?", addPlayerTitle: "1. Spieler hinzufügen", playerNameHint: "Spielername (1-100)", addButton: "Hinzuf.", timeSettingsTitle: "2. Zeiteinstellungen", baseTimeLabel: "Basiszeit", extraTimeLabel: "Extrazeit", unitSec: "sek", unitMin: "min", gameModeTitle: "3. Spielmodus-Einstellungen", suddenDeathLabel: "Sudden-Death-Modus aktivieren", quickTurnBonusLabel: "Schnellzug-Bonus", quickTurnBonusDesc: 'Erhalte +<input type="number" id="bonus-reward-time" value="3" class="w-16 text-center mx-1 border-b">s Bonus bei Zug innerhalb von <input type="number" id="bonus-condition-time" value="5" class="w-16 text-center mx-1 border-b">s!', startGameButton: "Spiel starten", turnSuffix: " ist dran", extraTimeIndicator: "Extrazeit wird genutzt", extraTimeRemaining: "Verbleibende Extrazeit:", nextTurnButton: "Nächster Zug", startButton: "Start", leaderboardTitle: "Rangliste", leaderboardDesc: "Reihenfolge ändern (▲/▼) / Details (Klick)", controlPanelTitle: "Steuerung", endGameButton: "Spiel beenden", totalTimeLabel: "Gesamtzeit:", victoryTitle: "🏆 SIEG 🏆", viewResultsButton: "Ergebnisse ansehen", playerSettingsTitle: "Spieler-Einstellungen", playerSettingsDesc: "Spitznamen und Farbe festlegen.", colorLabel: "Farbe:", nicknameInputHint: "Wunschnamen eingeben", cancelButton: "Abbrechen", confirmButton: "Bestätigen", scoreInputTitle: "Punkte eingeben", scoreInputDesc: "Gib die Endpunktzahl für jeden Spieler ein.", newGameButton: "Neues Spiel", saveAsImageButton: "Als Bild speichern", alertNameExists: "Dieser Name ist bereits vergeben.", alertColorExists: "Diese Farbe ist bereits vergeben.", alertMaxPlayers: "Maximal 100 Spieler können hinzugefügt werden.", alertNicknameRequired: "Bitte gib einen Spitznamen ein oder wähle einen aus.", notificationBonus: "+{time}s Bonus!", notificationEliminated: "{name} ist ausgeschieden!", detailsTitle: "{name} - Detaillierte Aufzeichnungen", detailsNoRecords: "Noch keine Aufzeichnungen.",
                },
                es: {
                    settingsTitle: "Ajustes del Temporizador", gameNameLabel: "Nombre del Juego", gameNameHint: "¿Cuál es el juego de hoy?", addPlayerTitle: "1. Añadir Jugadores", playerNameHint: "Nombre (1-100)", addButton: "Añadir", timeSettingsTitle: "2. Ajustes de Tiempo", baseTimeLabel: "Tiempo Base", extraTimeLabel: "Tiempo Extra", unitSec: "seg", unitMin: "min", gameModeTitle: "3. Ajustes de Modo de Juego", suddenDeathLabel: "Activar Modo Muerte Súbita", quickTurnBonusLabel: "Bono de Turno Rápido", quickTurnBonusDesc: '¡Obtén +<input type="number" id="bonus-reward-time" value="3" class="w-16 text-center mx-1 border-b">s extra por pasar en <input type="number" id="bonus-condition-time" value="5" class="w-16 text-center mx-1 border-b">s!', startGameButton: "Iniciar Juego", turnSuffix: " - tu turno", extraTimeIndicator: "Usando Tiempo Extra", extraTimeRemaining: "Tiempo extra restante:", nextTurnButton: "Siguiente Turno", startButton: "Iniciar", leaderboardTitle: "Clasificación", leaderboardDesc: "Cambiar orden (▲/▼) / Ver récords (Clic)", controlPanelTitle: "Panel de Control", endGameButton: "Terminar Juego", totalTimeLabel: "Tiempo Total:", victoryTitle: "🏆 VICTORIA 🏆", viewResultsButton: "Ver Resultados", playerSettingsTitle: "Ajustes de Jugador", playerSettingsDesc: "Elige apodo y color.", colorLabel: "Color:", nicknameInputHint: "Introduce el apodo deseado", cancelButton: "Cancelar", confirmButton: "Confirmar", scoreInputTitle: "Introducir Puntuaciones", scoreInputDesc: "Introduce la puntuación final de cada jugador.", newGameButton: "Nuevo Juego", saveAsImageButton: "Guardar como Imagen", alertNameExists: "Este nombre ya está en uso.", alertColorExists: "Este color ya está en uso.", alertMaxPlayers: "Se puede añadir un máximo de 100 jugadores.", alertNicknameRequired: "Por favor, introduce o selecciona un apodo.", notificationBonus: "¡+{time}s de Bono!", notificationEliminated: "¡{name} ha sido eliminado!", detailsTitle: "{name} - Registros Detallados", detailsNoRecords: "Aún no hay registros.",
                },
                ko: {
                    settingsTitle: "게임 타이머 설정", gameNameLabel: "게임 이름", gameNameHint: "오늘의 게임 이름은?", addPlayerTitle: "1. 플레이어 추가", playerNameHint: "플레이어 이름 (1-100명)", addButton: "추가", timeSettingsTitle: "2. 시간 설정", baseTimeLabel: "기본 시간", extraTimeLabel: "추가 시간", unitSec: "초", unitMin: "분", gameModeTitle: "3. 게임 모드 설정", suddenDeathLabel: "서든데스 모드 활성화", quickTurnBonusLabel: "퀵 턴 보너스", quickTurnBonusDesc: '턴 시작 후 <input type="number" id="bonus-condition-time" value="5" class="w-16 text-center mx-1 border-b">초 안에 넘기면 추가 시간 <input type="number" id="bonus-reward-time" value="3" class="w-16 text-center mx-1 border-b">초 획득!', startGameButton: "게임 시작", turnSuffix: "님의 차례입니다", extraTimeIndicator: "추가 시간 사용 중", extraTimeRemaining: "남은 추가 시간:", nextTurnButton: "차례 넘기기", startButton: "시작", leaderboardTitle: "리더보드", leaderboardDesc: "순서 변경(▲/▼) / 기록 보기(클릭)", controlPanelTitle: "제어판", endGameButton: "게임 종료", totalTimeLabel: "총 진행 시간:", victoryTitle: "🏆 승리 🏆", viewResultsButton: "결과 보기", playerSettingsTitle: "플레이어 설정", playerSettingsDesc: "닉네임과 색상을 설정해주세요.", colorLabel: "색상:", nicknameInputHint: "원하는 닉네임 입력", cancelButton: "취소", confirmButton: "확인", scoreInputTitle: "점수 입력", scoreInputDesc: "각 플레이어의 최종 점수를 입력하세요.", newGameButton: "새 게임 시작", saveAsImageButton: "이미지로 저장", alertNameExists: "이미 사용 중인 닉네임입니다.", alertColorExists: "이미 사용 중인 색상입니다.", alertMaxPlayers: "플레이어는 최대 100명까지 추가할 수 있습니다.", alertNicknameRequired: "닉네임을 입력하거나 선택해주세요.", notificationBonus: "+{time}초 보너스!", notificationEliminated: "{name}님 탈락!", detailsTitle: "{name} - 상세 기록", detailsNoRecords: "아직 기록이 없습니다.",
                }
            };

            function getLanguage() {
                const lang = navigator.language.split('-')[0];
                return translations[lang] ? lang : 'en'; // 기본값 영어
            }

            function applyTranslations(lang) {
                const t = translations[lang];
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.dataset.i18n;
                    if (t[key]) {
                        if (key === 'quickTurnBonusDesc') {
                             const conditionTime = document.getElementById('bonus-condition-time').value;
                             const rewardTime = document.getElementById('bonus-reward-time').value;
                             el.innerHTML = t[key].replace('value="5"', `value="${conditionTime}"`).replace('value="3"', `value="${rewardTime}"`);
                        } else {
                            el.innerHTML = t[key];
                        }
                    }
                });
                document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                    const key = el.dataset.i18nPlaceholder;
                    if (t[key]) el.placeholder = t[key];
                });
                document.title = lang === 'ko' ? '게임 모드 타이머' : 'Game Mode Timer';
            }
            
            const currentLang = getLanguage();
            applyTranslations(currentLang);
            
            // --- UI 요소 ---
            // ... (이전 코드와 동일)

            // --- 나머지 스크립트 로직 ---
            // ... (이전 코드와 동일, 단 alert 메시지와 notification 메시지는 다국어 처리 필요)
            
            // 예시: 알림 메시지 다국어 처리
            function showNotification(messageKey, options = {}) {
                let message = translations[currentLang][messageKey] || messageKey;
                for (const key in options) {
                    message = message.replace(`{${key}}`, options[key]);
                }
                // ... showNotification 로직
            }
        });
    </script>
</body>
</html>