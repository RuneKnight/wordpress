<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Chosen Palette: "Deep Thought" - A refined and focused palette. The base is a clean, academic off-white (bg-slate-50). Text is a clear, dark slate (text-slate-800). Accent colors are a strong, intellectual navy (indigo-600) for core concepts, and a vibrant, motivational orange (orange-500) for challenges and AI interactions, symbolizing insight and breakthrough. -->
    <!-- Application Structure Plan: The structure remains a single-page hub. The key addition is enhancing the 'Deep Dive Challenge' section. When a problem is generated, it now includes a button to open a new 'Instructor's Guide' modal. This modal displays the answer, a step-by-step solution, and educational insights. This requires a more complex, structured JSON response from the Gemini API, separating the problem from its instructional guide, and new UI elements (button and modal) to present this information on demand. -->
    <!-- Visualization & Content Choices: 
        - Report Info: AI-Generated Deep Dive Problems with Instructor Guides. Goal: Provide a complete tool for both student challenge and instructor preparation. Viz/Method: The challenge card now includes a 'View Guide' button. This button triggers a new modal window. Interaction: Clicking 'Generate Challenge' fetches a structured JSON object. The problem is displayed. Clicking the 'View Guide' button on the card opens a modal with the corresponding answer, solution, and educational insight. Justification: This separation keeps the student-facing view clean and challenging, while providing rich, on-demand support for the instructor in a non-intrusive way.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <title>ìˆ˜í•™ íƒí—˜ê°€ ì œë¯¸ | í™©ì†Œìˆ˜í•™ ìœµí•© ê¸°íš í—ˆë¸Œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc; /* bg-slate-50 */
            color: #1e293b; /* text-slate-800 */
        }
        h1, h2, h3, .font-display {
            font-family: 'Gowun Dodum', sans-serif;
        }
        .nav-button.active {
            color: #ea580c; /* orange-600 */
            border-bottom-color: #ea580c; /* orange-600 */
        }
        .grade-filter-button.active {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .table-responsive {
            display: block;
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #4f46e5; /* indigo-600 */
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .mission-card {
            border-left: 5px solid #f97316; /* orange-500 */
        }
    </style>
</head>
<body class="bg-slate-50">

    <header class="bg-white/90 backdrop-blur-sm shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl md:text-2xl font-bold text-slate-800">
                        <span class="text-indigo-600">ìˆ˜í•™ íƒí—˜ê°€ ì œë¯¸</span> | ìœµí•© ê¸°íš í—ˆë¸Œ
                    </h1>
                </div>
                <nav class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#curriculum" class="nav-button text-slate-600 hover:text-orange-600 px-3 py-2 text-sm font-bold border-b-2 border-transparent transition-all duration-300">ì»¤ë¦¬í˜ëŸ¼ ë§µ</a>
                        <a href="#challenge" class="nav-button text-slate-600 hover:text-orange-600 px-3 py-2 text-sm font-bold border-b-2 border-transparent transition-all duration-300">ì‚¬ê³ ë ¥ ì±Œë¦°ì§€</a>
                        <a href="#engagement" class="nav-button text-slate-600 hover:text-orange-600 px-3 py-2 text-sm font-bold border-b-2 border-transparent transition-all duration-300">ì°¸ì—¬ ì „ëµ</a>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 sm:p-6 lg:px-8">

        <!-- Intro -->
        <section class="text-center mb-16">
            <h2 class="text-4xl font-bold text-slate-800 mb-4">ê°œë… íƒí—˜ê³¼ ì‚¬ê³ ë ¥ í›ˆë ¨ì˜ ë§Œë‚¨</h2>
            <p class="text-lg max-w-3xl mx-auto text-slate-600">
                'ìˆ˜í•™ íƒí—˜ê°€ ì œë¯¸'ì˜ ì¦ê±°ìš´ íƒêµ¬ ë°©ì‹ì— 'í™©ì†Œìˆ˜í•™'ì˜ ê¹Šì´ ìˆëŠ” ì‚¬ê³ ë ¥ í›ˆë ¨ì„ ë”í–ˆìŠµë‹ˆë‹¤. ì•„ì´ë“¤ì´ ê°œë…ì„ ë„˜ì–´ ë¬¸ì œì˜ ë³¸ì§ˆì„ ê¿°ëš«ì–´ ë³´ë„ë¡ ì´ëŒì–´ì£¼ëŠ” ìƒˆë¡œìš´ êµìœ¡ ì—¬ì •ì„ ì œì•ˆí•©ë‹ˆë‹¤.
            </p>
        </section>

        <!-- Section 1: Curriculum Map -->
        <section id="curriculum" class="scroll-mt-20 mb-16">
            <div class="text-center mb-12">
                <span class="bg-indigo-100 text-indigo-800 text-sm font-bold px-3 py-1 rounded-full">PLAN</span>
                <h2 class="text-3xl font-bold mt-2">ìœµí•© ì»¤ë¦¬í˜ëŸ¼ ë§µ</h2>
                <p class="mt-4 max-w-2xl mx-auto text-slate-600">í•™ë…„ë³„ í•™ìŠµ ëª©í‘œì™€ í•¨ê»˜, í™©ì†Œìˆ˜í•™ì´ ì¶”êµ¬í•˜ëŠ” 'ì‚¬ê³ ë ¥ ëª©í‘œ'ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. AI ë„ìš°ë¯¸ì—ê²Œ ì•„ì´ì˜ ìƒê°ì„ ì´ëŒì–´ë‚´ëŠ” 'ë°œë¬¸ë²•'ì— ëŒ€í•œ ì¡°ì–¸ì„ êµ¬í•´ë³´ì„¸ìš”.</p>
            </div>

            <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                <div class="flex flex-wrap justify-center gap-2 sm:gap-3 mb-6">
                    <button class="grade-filter-button active px-4 py-2 text-sm sm:text-base font-bold bg-white border border-slate-200 rounded-full shadow-sm hover:shadow-md transition-all duration-200" data-grade="all">ì „ì²´ë³´ê¸°</button>
                    <button class="grade-filter-button px-4 py-2 text-sm sm:text-base font-bold bg-white border border-slate-200 rounded-full shadow-sm hover:shadow-md transition-all duration-200" data-grade="2í•™ë…„">2í•™ë…„</button>
                    <button class="grade-filter-button px-4 py-2 text-sm sm:text-base font-bold bg-white border border-slate-200 rounded-full shadow-sm hover:shadow-md transition-all duration-200" data-grade="3í•™ë…„">3í•™ë…„</button>
                    <button class="grade-filter-button px-4 py-2 text-sm sm:text-base font-bold bg-white border border-slate-200 rounded-full shadow-sm hover:shadow-md transition-all duration-200" data-grade="4í•™ë…„">4í•™ë…„</button>
                    <button class="grade-filter-button px-4 py-2 text-sm sm:text-base font-bold bg-white border border-slate-200 rounded-full shadow-sm hover:shadow-md transition-all duration-200" data-grade="5í•™ë…„">5í•™ë…„</button>
                    <button class="grade-filter-button px-4 py-2 text-sm sm:text-base font-bold bg-white border border-slate-200 rounded-full shadow-sm hover:shadow-md transition-all duration-200" data-grade="6í•™ë…„">6í•™ë…„</button>
                </div>

                <div class="table-responsive">
                    <table class="w-full text-sm text-left text-slate-600" id="curriculum-table">
                        <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                            <tr>
                                <th scope="col" class="px-6 py-3">í•™ë…„</th>
                                <th scope="col" class="px-6 py-3">ì£¼ìš” í•™ìŠµ ê°œë…</th>
                                <th scope="col" class="px-6 py-3">ì‚¬ê³ ë ¥ ëª©í‘œ (í™©ì†Œìˆ˜í•™)</th>
                                <th scope="col" class="px-6 py-3">Struggle Point</th>
                                <th scope="col" class="px-6 py-3">AI ë°œë¬¸ ì½”ì¹­</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-200">
                            <!-- Table data rows will be injected here by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Section 2: Deep Dive Challenge -->
        <section id="challenge" class="scroll-mt-20 mb-16">
            <div class="text-center mb-12">
                <span class="bg-orange-100 text-orange-800 text-sm font-bold px-3 py-1 rounded-full">CHALLENGE</span>
                <h2 class="text-3xl font-bold mt-2">AI í™©ì†Œìˆ˜í•™ ì±Œë¦°ì§€ ìƒì„±ê¸°</h2>
                <p class="mt-4 max-w-2xl mx-auto text-slate-600">ê°œë… í•™ìŠµ í›„, ë” ê¹Šì€ ì‚¬ê³ ê°€ í•„ìš”í•œ ë¬¸ì œì— ë„ì „í•´ë³´ì„¸ìš”. AIê°€ ìƒì„±í•œ ë¬¸ì œì˜ í•´ì„¤ê³¼ êµìœ¡ì  ê°€ì´ë“œëŠ” 'ì§€ë„ììš© ê°€ì´ë“œ'ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
            
             <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg mb-8">
                <div class="grid md:grid-cols-3 gap-4 items-end">
                    <div>
                        <label for="grade-select" class="block text-sm font-medium text-slate-700">í•™ë…„ ì„ íƒ</label>
                        <select id="grade-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"></select>
                    </div>
                    <div>
                        <label for="concept-select" class="block text-sm font-medium text-slate-700">í•™ìŠµ ê°œë… ì„ íƒ</label>
                        <select id="concept-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"></select>
                    </div>
                    <button id="generate-challenge-btn" class="w-full bg-orange-500 text-white font-bold py-2 px-4 rounded-md hover:bg-orange-600 transition-colors flex items-center justify-center">
                        ğŸ”¥ ì±Œë¦°ì§€ ìƒì„±!
                    </button>
                </div>
            </div>

            <div id="challenge-output" class="relative">
                 <div id="challenge-loader" class="hidden justify-center items-center py-8">
                    <div class="loader"></div>
                    <p class="ml-4 text-slate-600 font-semibold">AIê°€ ì‚¬ê³ ë ¥ ë¬¸ì œë¥¼ ë§Œë“¤ê³  ìˆì–´ìš”...</p>
                 </div>
                <div id="challenge-card-container" class="space-y-6">
                    <!-- AI Generated challenge cards will be injected here -->
                </div>
            </div>
        </section>

        <!-- Section 3: Engagement -->
        <section id="engagement" class="scroll-mt-20">
            <div class="text-center mb-12">
                <span class="bg-indigo-100 text-indigo-800 text-sm font-bold px-3 py-1 rounded-full">ENGAGE</span>
                <h2 class="text-3xl font-bold mt-2">ë„ì „í•˜ê³  ì„±ì¥í•˜ëŠ” ì»¤ë®¤ë‹ˆí‹°</h2>
                <p class="mt-4 max-w-2xl mx-auto text-slate-600">í™©ì†Œìˆ˜í•™ì˜ 'ë„ì „ ì •ì‹ 'ì„ ì»¤ë®¤ë‹ˆí‹°ì— ì ìš©í•˜ì—¬, ì•„ì´ì™€ ë¶€ëª¨ ëª¨ë‘ í•¨ê»˜ ì„±ì¥í•˜ëŠ” ì°¸ì—¬ ì „ëµì„ ì œì•ˆí•©ë‹ˆë‹¤.</p>
            </div>
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Engagement cards will be injected here by JS -->
            </div>
        </section>

    </main>

    <footer class="bg-slate-800 text-white mt-16">
        <div class="container mx-auto py-6 px-4 text-center">
            <p class="font-display text-lg">ìˆ˜í•™ íƒí—˜ê°€ ì œë¯¸</p>
            <p class="text-sm text-slate-400">ìƒê°ì˜ í˜ì„ í‚¤ìš°ëŠ” ëª¨ë“  íƒí—˜ê°€ë¥¼ ì‘ì›í•©ë‹ˆë‹¤.</p>
        </div>
    </footer>
    
    <!-- Modals -->
    <div id="ai-help-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 hidden" role="dialog" aria-modal="true">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-lg p-6 transform scale-95">
            <div class="flex justify-between items-start">
                <h3 class="text-lg font-bold font-display text-indigo-700">ğŸ’¡ AI ë°œë¬¸ ì½”ì¹­</h3>
                <button class="js-modal-close text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
            </div>
            <div class="modal-body mt-4 text-slate-600 min-h-[120px] flex items-center justify-center"></div>
        </div>
    </div>
    
    <div id="guide-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 hidden" role="dialog" aria-modal="true">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-2xl p-6 transform scale-95 overflow-y-auto max-h-[90vh]">
            <div class="flex justify-between items-start sticky top-0 bg-white py-2">
                <h3 class="text-lg font-bold font-display text-orange-600">ğŸ“ ì§€ë„ììš© ê°€ì´ë“œ</h3>
                <button class="js-modal-close text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
            </div>
            <div class="modal-body mt-4 text-slate-700 space-y-4"></div>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', function() {

        // --- Data Storage ---
        const curriculumData = [
            { grade: '2í•™ë…„', concept: 'ì„¸ ìë¦¬ ìˆ˜', thinkingGoal: 'ìë¦¿ê°’ì˜ ì›ë¦¬ë¥¼ ì´ìš©í•´ ìˆ˜ì˜ í¬ê¸°ë¥¼ ë…¼ë¦¬ì ìœ¼ë¡œ ë¹„êµí•˜ê³  ì„¤ëª…í•˜ê¸°', struggle: 'ìë¦¿ê°’ ê°œë…ì˜ í˜¼ë™' },
            { grade: '2í•™ë…„', concept: 'ê³±ì…ˆêµ¬êµ¬', thinkingGoal: 'ë°˜ë³µë˜ëŠ” ë§ì…ˆì˜ ê·œì¹™ì„±ì„ ë°œê²¬í•˜ê³  ê³±ì…ˆì‹ìœ¼ë¡œ ì¼ë°˜í™”í•˜ê¸°', struggle: 'ë¬´ì˜ë¯¸í•œ ì•”ê¸°ë¡œ ì¸í•œ ì§€ë£¨í•¨' },
            { grade: '3í•™ë…„', concept: 'ë‚˜ëˆ—ì…ˆ', thinkingGoal: 'ë‹¤ì–‘í•œ ë‚˜ëˆ—ì…ˆ ìƒí™©ì„ ì‹ìœ¼ë¡œ í‘œí˜„í•˜ê³ , ì‹¤ìƒí™œ ë¬¸ì œì— ì ìš©í•˜ê¸°', struggle: 'ëª«ê³¼ ë‚˜ë¨¸ì§€ ê°œë… í˜¼ë™' },
            { grade: '3í•™ë…„', concept: 'ë¶„ìˆ˜ì™€ ì†Œìˆ˜', thinkingGoal: 'ì „ì²´ë¥¼ ë˜‘ê°™ì´ ë‚˜ëˆˆë‹¤ëŠ” ê°œë…(ë“±ë¶„í• )ì„ ì´ìš©í•´ ì—¬ëŸ¬ ìƒí™©ì„ ë¶„ìˆ˜ë¡œ ëª¨ë¸ë§í•˜ê¸°', struggle: 'ìì—°ìˆ˜ì™€ ë‹¤ë¥¸ ìˆ˜ ì²´ê³„ì— ëŒ€í•œ í˜¼ë€' },
            { grade: '4í•™ë…„', concept: 'í˜¼í•©ê³„ì‚°', thinkingGoal: 'ê³„ì‚° ìˆœì„œì˜ ì´ìœ ë¥¼ ì´í•´í•˜ê³ , ë³µì¡í•œ ë¬¸ì œ ìƒí™©ì„ í•˜ë‚˜ì˜ ì‹ìœ¼ë¡œ í‘œí˜„í•˜ê¸°', struggle: 'ê³„ì‚° ìˆœì„œ ê·œì¹™ì˜ ë³µì¡í•¨' },
            { grade: '4í•™ë…„', concept: 'í‰ë©´ë„í˜•ì˜ ì´ë™', thinkingGoal: 'ë„í˜•ì˜ ì´ë™ ê·œì¹™ì„ ì˜ˆì¸¡í•˜ê³ , ì´ë™ ì „í›„ì˜ ê´€ê³„ë¥¼ ë…¼ë¦¬ì ìœ¼ë¡œ ì„¤ëª…í•˜ê¸°', struggle: 'ë¨¸ë¦¿ì†ìœ¼ë¡œ ë„í˜•ì„ ì¡°ì‘í•˜ëŠ” ì–´ë ¤ì›€' },
            { grade: '5í•™ë…„', concept: 'ì•½ìˆ˜ì™€ ë°°ìˆ˜', thinkingGoal: 'ë‘ ìˆ˜ì˜ ê´€ê³„ë¥¼ íŒŒì•…í•˜ê³ , ìµœëŒ€ê³µì•½ìˆ˜/ìµœì†Œê³µë°°ìˆ˜ë¥¼ í™œìš©í•´ ì‹¤ìƒí™œì˜ íš¨ìœ¨ì„± ë¬¸ì œ í•´ê²°í•˜ê¸°', struggle: 'ìˆ˜ ì‚¬ì´ì˜ ê´€ê³„ íŒŒì•…ì˜ ì¶”ìƒì„±' },
            { grade: '5í•™ë…„', concept: 'ë¶„ìˆ˜ì˜ ë§ì…ˆê³¼ ëº„ì…ˆ', thinkingGoal: 'í†µë¶„ì˜ í•„ìš”ì„±ì„ ì´í•´í•˜ê³ , ê¸°ì¤€ì´ ë‹¤ë¥¸ ë‘ ì–‘ì„ ë¹„êµí•˜ëŠ” ë…¼ë¦¬ í„°ë“í•˜ê¸°', struggle: 'í†µë¶„ì´ë¼ëŠ” ë³µì¡í•œ ì ˆì°¨' },
            { grade: '6í•™ë…„', concept: 'ë¹„ì™€ ë¹„ìœ¨', thinkingGoal: 'ë¹„ìœ¨ì„ ì´ìš©í•´ ì „ì²´ì™€ ë¶€ë¶„ì˜ ê´€ê³„ë¥¼ ì¶”ë¡ í•˜ê³ , ë³€í™”í•˜ëŠ” ìƒí™© ì˜ˆì¸¡í•˜ê¸°', struggle: 'ê°œë… ìì²´ì˜ ì¶”ìƒì„±, ë¬¸ì œ ì ìš©ì˜ ì–´ë ¤ì›€' },
            { grade: '6í•™ë…„', concept: 'ê²½ìš°ì˜ ìˆ˜', thinkingGoal: 'ì¡°ê±´ì— ë§ëŠ” ëª¨ë“  ê°€ëŠ¥ì„±ì„ ì²´ê³„ì ìœ¼ë¡œ, ì¤‘ë³µê³¼ ëˆ„ë½ ì—†ì´ ì°¾ì•„ë‚´ëŠ” ì „ëµ ì„¸ìš°ê¸°', struggle: 'ë…¼ë¦¬ì  ì²´ê³„ ë¶€ì¡±' },
        ];

        const engagementData = [
            { icon: 'ğŸ¯', title: 'ì´ë²ˆ ì£¼ ì‚¬ê³ ë ¥ ì±Œë¦°ì§€', content: "ë§¤ì£¼ ë¸”ë¡œê·¸ì— ì˜¬ë¼ì˜¤ëŠ” 'í™©ì†Œìˆ˜í•™ ì±Œë¦°ì§€'ì— ë„ì „! <strong>ì •ë‹µë³´ë‹¤ ì¤‘ìš”í•œ ê²ƒì€ ëê¹Œì§€ ê³ ë¯¼í•œ í”ì !</strong> í’€ì´ ê³¼ì •ì„ ëŒ“ê¸€ë¡œ ê³µìœ í•˜ê³ , ë‹¤ë¥¸ ì¹œêµ¬ë“¤ì˜ í’€ì´ì™€ ë¹„êµí•˜ë©° í•¨ê»˜ ì„±ì¥í•´ìš”." },
            { icon: 'ğŸ†', title: 'ëª…ì˜ˆì˜ ì „ë‹¹ & ë°°ì§€', content: '<strong>- ìƒê°ì˜ ì”¨ì•— ğŸŒ±:</strong> ì²« ì±Œë¦°ì§€ ë„ì „!<br><strong>- ëˆê¸°ìˆëŠ” íƒí—˜ê°€ ğŸ§­:</strong> í•œ ë‹¬ê°„ ê¾¸ì¤€íˆ ì±Œë¦°ì§€ ì°¸ì—¬<br><strong>- ë¬¸ì œ í•´ê²°ì‚¬ ğŸ’¡:</strong> ì–´ë ¤ìš´ ë¬¸ì œì˜ í•µì‹¬ì„ ì§šì–´ë‚¸ ì¹œêµ¬ì—ê²Œ ìˆ˜ì—¬<br>ì›”ê°„ ìš°ìˆ˜ í•´ê²°ì‚¬ \'ëª…ì˜ˆì˜ ì „ë‹¹\'ì— ë“±ê·¹!' },
            { icon: 'ğŸ’¡', title: 'í•™ë¶€ëª¨ë‹˜ì„ ìœ„í•œ ë°œë¬¸ë²• Tip', content: '<strong>- "ì™œ ê·¸ë ‡ê²Œ ìƒê°í•´?"</strong>: ì•„ì´ì˜ ë‹µì´ í‹€ë ¤ë„ ë°”ë¡œ ì§€ì í•˜ê¸°ë³´ë‹¤, ìƒê°ì˜ ê³¼ì •ì„ ë¬¼ì–´ë´ ì£¼ì„¸ìš”.<br><strong>- "ë‹¤ë¥¸ ë°©ë²•ì€ ì—†ì„ê¹Œ?":</strong> í•˜ë‚˜ì˜ ì •ë‹µì— ë§Œì¡±í•˜ì§€ ì•Šê³ , ë” íš¨ìœ¨ì ì´ê±°ë‚˜ ì°½ì˜ì ì¸ ë°©ë²•ì„ ì°¾ë„ë¡ ìœ ë„í•´ ì£¼ì„¸ìš”.<br><strong>- "ë§Œì•½ ~ë¼ë©´ ì–´ë–¨ê¹Œ?":</strong> ë¬¸ì œì˜ ì¡°ê±´ì„ ì‚´ì§ ë°”ê¿” ì§ˆë¬¸í•˜ë©°, ê°œë…ì„ ë” ê¹Šê³  ë„“ê²Œ ì´í•´í•˜ë„ë¡ ë„ì™€ì£¼ì„¸ìš”.' },
            { icon: 'ğŸ’¬', title: 'í•¨ê»˜ í‘¸ëŠ” ìˆ˜í•™, ëŒ“ê¸€ í† ë¡ ', content: '<strong>- ë‚˜ì˜ í’€ì´ë²• ìë‘í•˜ê¸°:</strong> "ì €ëŠ” ì´ ë¬¸ì œë¥¼ ì´ë ‡ê²Œ í’€ì—ˆì–´ìš”! ì—¬ëŸ¬ë¶„ì˜ ìƒê°ì€ ì–´ë•Œìš”?"<br><strong>- ë§‰íˆëŠ” ë¶€ë¶„ ì§ˆë¬¸í•˜ê¸°:</strong> "ì—¬ê¸°ê¹Œì§€ëŠ” ì•Œê² ëŠ”ë°, ê·¸ ë‹¤ìŒì€ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”? íŒíŠ¸ ì¢€ ì£¼ì„¸ìš”!"<br>ì„œë¡œ ë•ê³  í† ë¡ í•˜ë©° ì§‘ë‹¨ ì§€ì„±ì˜ í˜ì„ ê²½í—˜í•˜ê²Œ í•©ë‹ˆë‹¤.' },
        ];
        
        // --- Gemini API ---
        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        async function callGemini(prompt, isJson = false) {
             let payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }]
            };
            if(isJson) {
                payload.generationConfig = {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            title: { type: "STRING" },
                            problem: { type: "STRING" },
                            answer: { type: "STRING" },
                            solution: { type: "STRING" },
                            insight: { type: "STRING" }
                        },
                        required: ["title", "problem", "answer", "solution", "insight"]
                    }
                }
            }
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    throw new Error("No content from API.");
                }
            } catch (error) {
                console.error("Gemini API call error:", error);
                return "AI ì‘ë‹µì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
            }
        }

        // --- Render Functions ---
        function renderCurriculumTable() {
            const tbody = document.querySelector('#curriculum-table tbody');
            tbody.innerHTML = curriculumData.map(row => `
                <tr class="bg-white hover:bg-slate-50/50 curriculum-row" data-grade="${row.grade}">
                    <td class="px-6 py-4 font-bold text-slate-800">${row.grade}</td>
                    <td class="px-6 py-4 font-bold text-indigo-700">${row.concept}</td>
                    <td class="px-6 py-4">${row.thinkingGoal}</td>
                    <td class="px-6 py-4 text-orange-600">${row.struggle}</td>
                    <td class="px-6 py-4 text-center">
                        <button class="ai-help-btn text-indigo-500 hover:text-indigo-700 font-bold" data-concept="${row.concept}" data-struggle="${row.struggle}">
                            ğŸ’¡ ì½”ì¹­ë°›ê¸°
                        </button>
                    </td>
                </tr>
            `).join('');
            addAiHelpEventListeners();
        }

        function renderEngagementCards() {
            const container = document.querySelector('#engagement .grid');
            container.innerHTML = engagementData.map(item => `
                <div class="bg-white p-6 rounded-2xl shadow-lg h-full">
                    <h3 class="text-xl font-bold font-display mb-3">
                        <span class="text-2xl mr-2">${item.icon}</span>${item.title}
                    </h3>
                    <p class="text-slate-600 text-sm leading-relaxed">${item.content}</p>
                </div>
            `).join('');
        }

        function renderAiChallengeCard(challengeData) {
            const container = document.getElementById('challenge-card-container');
            container.innerHTML = ''; // Clear previous card
            const missionCard = document.createElement('div');
            missionCard.className = 'mission-card bg-white p-6 rounded-lg shadow-md';
            
            missionCard.innerHTML = `
                <h4 class="font-display text-lg font-bold text-orange-600 mb-2">${challengeData.title}</h4>
                <p class="text-slate-700 leading-relaxed">${challengeData.problem.replace(/\n/g, '<br>')}</p>
                <div class="text-right mt-4">
                    <button class="guide-btn bg-indigo-500 text-white text-sm font-bold py-2 px-4 rounded-md hover:bg-indigo-600 transition-colors">
                        ğŸ“ ì§€ë„ììš© ê°€ì´ë“œ ë³´ê¸°
                    </button>
                </div>
            `;
            
            missionCard.querySelector('.guide-btn').addEventListener('click', () => {
                const guideModal = document.getElementById('guide-modal');
                const guideBody = guideModal.querySelector('.modal-body');
                guideBody.innerHTML = `
                    <div class="p-4 bg-slate-100 rounded-lg">
                        <h4 class="font-bold text-slate-800">ì •ë‹µ</h4>
                        <p>${challengeData.answer}</p>
                    </div>
                    <div class="p-4 bg-slate-100 rounded-lg">
                        <h4 class="font-bold text-slate-800">í’€ì´ ê³¼ì •</h4>
                        <p>${challengeData.solution.replace(/\n/g, '<br>')}</p>
                    </div>
                    <div class="p-4 bg-slate-100 rounded-lg">
                        <h4 class="font-bold text-slate-800">êµìœ¡ì  í™œìš© ê°€ì´ë“œ</h4>
                        <p>${challengeData.insight.replace(/\n/g, '<br>')}</p>
                    </div>
                `;
                guideModal.classList.remove('hidden');
            });

            container.appendChild(missionCard);
        }

        // --- Event Listeners and Initial Calls ---
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                }
            });
            modal.querySelector('.js-modal-close').addEventListener('click', () => {
                modal.classList.add('hidden');
            });
        });
        
        function showModalLoader(modal) {
             const body = modal.querySelector('.modal-body');
             body.innerHTML = '<div class="loader"></div><p class="ml-3 text-slate-500">AIê°€ ìƒê° ì¤‘ì…ë‹ˆë‹¤...</p>';
        }

        function addAiHelpEventListeners() {
            const helpModal = document.getElementById('ai-help-modal');
            document.querySelectorAll('.ai-help-btn').forEach(button => {
                button.addEventListener('click', async () => {
                    const concept = button.dataset.concept;
                    const struggle = button.dataset.struggle;
                    helpModal.classList.remove('hidden');
                    showModalLoader(helpModal);

                    const prompt = `You are a Socratic math coach for parents, in the style of 'Hwangso Math'. A parent is struggling because their child has difficulty with '${struggle}' while learning '${concept}'. Provide two simple but powerful Socratic questions (ë°œë¬¸) in Korean that the parent can ask the child. These questions should not give away the answer but should prompt the child to think deeper about the problem on their own. Explain briefly in one sentence why each question is effective. Format as: \n\nì§ˆë¬¸ 1: [Question]\n(íš¨ê³¼: [Reason])\n\nì§ˆë¬¸ 2: [Question]\n(íš¨ê³¼: [Reason])`;
                    const response = await callGemini(prompt);
                    helpModal.querySelector('.modal-body').innerHTML = `<div class="text-left w-full">${response.replace(/\n/g, '<br>')}</div>`;
                });
            });
        }
        
        // Challenge Generator Logic
        const gradeSelect = document.getElementById('grade-select');
        const conceptSelect = document.getElementById('concept-select');
        const generateBtn = document.getElementById('generate-challenge-btn');
        const challengeLoader = document.getElementById('challenge-loader');

        function populateSelectors() {
            const grades = [...new Set(curriculumData.map(item => item.grade))];
            grades.forEach(grade => {
                gradeSelect.innerHTML += `<option value="${grade}">${grade}</option>`;
            });
            updateConceptSelect();
        }

        function updateConceptSelect() {
            const selectedGrade = gradeSelect.value;
            const concepts = curriculumData
                .filter(item => item.grade === selectedGrade)
                .map(item => item.concept);
            
            conceptSelect.innerHTML = '';
            concepts.forEach(concept => {
                conceptSelect.innerHTML += `<option value="${concept}">${concept}</option>`;
            });
        }

        gradeSelect.addEventListener('change', updateConceptSelect);

        generateBtn.addEventListener('click', async () => {
            const grade = gradeSelect.value;
            const concept = conceptSelect.value;

            challengeLoader.style.display = 'flex';
            document.getElementById('challenge-card-container').innerHTML = '';
            generateBtn.disabled = true;
            generateBtn.classList.add('opacity-50', 'cursor-not-allowed');

            const prompt = `Create one challenging math problem for a South Korean elementary school student. This problem should be in the style of 'Hwangso Math', focusing on deep thinking and problem-solving.
            - Grade: ${grade}
            - Core Concept: ${concept}
            - The problem must be solvable with the knowledge of that grade level but should require multiple steps or creative thinking.
            - Respond with a JSON object that has the following structure: { "title": "Problem Title in Korean", "problem": "Problem statement in Korean", "answer": "The final answer in Korean", "solution": "A step-by-step solution process in Korean", "insight": "A brief explanation for an instructor about the key mathematical thinking skills this problem helps develop, in Korean." }`;
            
            try {
                const responseText = await callGemini(prompt, true);
                const challengeData = JSON.parse(responseText);
                renderAiChallengeCard(challengeData);
            } catch(e) {
                document.getElementById('challenge-card-container').innerHTML = `<p class="text-center text-red-500">ë¬¸ì œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</p>`;
                console.error("Failed to generate or parse challenge:", e);
            }
            
            challengeLoader.style.display = 'none';
            generateBtn.disabled = false;
            generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        });

        // Initial setup
        renderCurriculumTable();
        renderEngagementCards();
        populateSelectors();


        // Table filtering logic
        document.querySelectorAll('.grade-filter-button').forEach(button => {
            button.addEventListener('click', () => {
                const selectedGrade = button.dataset.grade;
                document.querySelectorAll('.grade-filter-button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                document.querySelectorAll('.curriculum-row').forEach(row => {
                    row.style.display = (selectedGrade === 'all' || row.dataset.grade === selectedGrade) ? '' : 'none';
                });
            });
        });

        // Navigation scroll behavior
        window.addEventListener('scroll', () => {
            let current = '';
            document.querySelectorAll('section').forEach(section => {
                if (window.pageYOffset >= section.offsetTop - 80) current = section.id;
            });
            document.querySelectorAll('.nav-button').forEach(link => {
                link.classList.toggle('active', link.getAttribute('href').substring(1) === current);
            });
        });
        
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
            });
        });
    });
    </script>
</body>
</html>
